/*
 2018 (c) Sahana Software Foundation
 @license MIT

 Global variables/functions:

 - uses/applies:

   - S3.dataTables                   - global object for datatables configuration
   - S3.dataTables.id                - global array of DOM-ids of data tables
   - S3.dataTables.initComplete      - global callback function (optional)
   - S3.dataTables.Actions           - global array of per-row actions

   - $.searchDownloadS3              - provided by s3.filter.js, used for exports
   - S3.addModals                    - provided by S3.js
   - variableColumns                 - provided by s3.ui.columns.js (widget)
*/
(function(e,w){function z(){this.data=[];this.slices=[];this.availableRecords=-1}var D=0,B=function(a,b){for(var c=0,d=b.length;c<d;c++)if(a==b[c])return c;return-1},E=function(a,b,c){a=a.split("?");b&&(a[0]+="."+b);c&&(1<a.length?a[1]+="&"+c:a.push(c));return a.join("?")},G=function(a,b){var c=function(g){return-1!=g.indexOf(".")||"("==g[0]},d=function(g,k){return g&&g.split("&").filter(function(h){h=h.split("=");return 1<h.length&&k(S3.urlDecode(h[0]))})||[]};a=a.split("?");b=b.split("?");var f=
d(a[1],function(g){return!c(g)&&"w"!=g[0]});a[1]=f.concat(d(b[1],c)).join("&");return a.join("?")};z.prototype.store=function(a,b,c){c!==w&&(this.availableRecords=c);if(c=b.length){var d=this.data,f=this.slices;b.forEach(function(k,h){d[a+h]=k});f.push([a,a+c]);f.sort(function(k,h){var m=k[0]-h[0];return 0!==m?m:k[1]-h[1]});if(1<f.length){var g=[];b=f.reduce(function(k,h){return k[1]<h[0]||k[0]>h[1]?(g.push(k),h):[Math.min(k[0],h[0]),Math.max(k[1],h[1])]});g.push(b);this.slices=g}}};z.prototype.retrieve=
function(a,b){var c=this.availableRecords;if(0>c)return null;0>a&&(a=0);if(a>=c)return[];b=a+b;b>c&&(b=c);c=this.slices;for(var d,f=c.length,g=0;g<f;g++)if(d=c[g],a>=d[0]&&b<=d[1])return this.data.slice(a,b);return null};z.prototype.clear=function(){this.cache=[];this.slices=[];this.availableRecords=-1};e.widget("s3.dataTableS3",{options:{destroy:!1},_create:function(){this.id=D;D+=1;this.eventNamespace=".dataTableS3"},_init:function(){const a=e(this.element),b=a.attr("id");this.tableID=b;this.selector=
"#"+b;this.outerForm=a.closest("form.dt-wrapper");e(".column-selector",this.outerForm).hide();this.refresh()},_destroy:function(){e.Widget.prototype.destroy.call(this)},refresh:function(){var a=e(this.element),b=this.options;this._unbindEvents();e(this.selector+"_dataTable_cache").prop("disabled",!0);e(this.selector+"_configurations").prop("disabled",!0);var c=this._parseConfig();if(c!==w){var d=!0,f=!0,g=null;c.pagination?(this.ajaxUrl=c.ajaxUrl,g=this._pipeline({cache:this._initCache()})):f=d=!1;
this._bulkSelectRestore();a.dataTable({ajax:g,autoWidth:!1,columns:this.columnConfigs,deferRender:!0,destroy:b.destroy,dom:c.dom,lengthMenu:c.lengthMenu,order:c.order,orderFixed:c.group,ordering:!0,pageLength:c.pageLength,pagingType:c.pagingType,processing:f,searchDelay:450,searching:c.searching,serverSide:d,search:{smart:d},language:{aria:{sortAscending:": "+i18n.sortAscending,sortDescending:": "+i18n.sortDescending},paginate:{first:i18n.first,last:i18n.last,next:i18n.next,previous:i18n.previous},
emptyTable:i18n.emptyTable,info:i18n.info,infoEmpty:i18n.infoEmpty,infoFiltered:i18n.infoFiltered,infoThousands:i18n.infoThousands,lengthMenu:i18n.lengthMenu,loadingRecords:i18n.loadingRecords+"...",processing:i18n.processing+"...",search:i18n.search+":",zeroRecords:i18n.zeroRecords},rowCallback:this._rowCallback(),drawCallback:this._drawCallback(),initComplete:S3.dataTables.initComplete});this._bindEvents()}},_parseConfig:function(){var a=e(this.element),b=e(this.selector+"_configurations");if(b.length){this.tableConfig=
b=JSON.parse(b.val());b.rowActions.length?b.rowActionsJSON=!0:(b.rowActionsJSON=!1,b.rowActions=S3.dataTables.Actions?S3.dataTables.Actions:[]);var c=[];a=e("thead tr",a).children().length;for(var d=0;d<a;d++)c[d]=null;0<b.rowActions.length&&(c[b.actionCol]={sTitle:" ",bSortable:!1,className:"dt-actions actions"});b.bulkActions&&(a=" ",b.bulkSingle||(a='<div class="bulk-select-options"><input class="bulk-select-all" type="checkbox" title="'+i18n.selectAll+'"></input></div>'),c[b.bulkCol]={sTitle:a,
bSortable:!1,className:"dt-bulk"});if(b.colWidths){var f;a=b.colWidths;for(f in a)null!=c[f]?c[f].sWidth=a[f]:c[f]={sWidth:a[f]}}this.columnConfigs=c;return b}},_pipeline:function(a){var b=e.extend({cache:{},pages:2,data:null,method:"GET"},a);a=b.cache;var c=a.cacheLastRequest||null,d=a.cacheLastJson||null,f=a.cacheLower;f===w&&(f=-1);var g=new z;d&&-1!=f&&g.store(f,d.data,d.recordsFiltered||d.recordsTotal);var k=this;return function(h,m,p){if(this.hasOwnProperty("nTable")){if(h=p.sAjaxSource)k.ajaxUrl=
h,p.sAjaxSource=null;c=d=null;f=-1;g.clear();m({})}else{var n=!1,l=h.start,r=h.start,t=h.length,q=h.recordsTotal,u=q;d&&(d.recordsTotal!==w&&(q=d.recordsTotal),u=d.recordsFiltered!==w?d.recordsFiltered:q);k.totalRecords=q;-1==t&&(l=0,u!==w?t=u:n=!0);if(!n)if(q=l+t,p.clearCache)g.clear(),p.clearCache=!1,n=!0;else if(!c||JSON.stringify(h.order)===JSON.stringify(c.order)&&JSON.stringify(h.columns)===JSON.stringify(c.columns)&&JSON.stringify(h.search)===JSON.stringify(c.search)){var v=g.retrieve(l,q-
l);null===v&&(n=!0)}else g.clear(),n=!0;c=e.extend(!0,{},h);if(n){l<f&&(l-=t*(b.pages-1),0>l&&(l=0));f=l;h.start=l;h.length=t*b.pages;e.isFunction(b.data)?(v=b.data(h))&&e.extend(h,v):e.isPlainObject(b.data)&&e.extend(h,b.data);v=[{name:"draw",value:h.draw},{name:"limit",value:-1==t?"none":h.length}];0!=l&&v.push({name:"start",value:l});h.search&&h.search.value&&(v.push({name:"sSearch",value:h.search.value}),v.push({name:"iColumns",value:h.columns.length}));if(n=h.order.length){v.push({name:"iSortingCols",
value:n});u=k.columnConfigs;var A;for(q=0;q<u.length;q++)(A=u[q])&&!A.bSortable&&v.push({name:"bSortable_"+q,value:"false"});for(q=0;q<n;q++)u=h.order[q],v.push({name:"iSortCol_"+q,value:u.column}),v.push({name:"sSortDir_"+q,value:u.dir})}h=e.ajaxS3;var F=!1;e.searchS3!==w&&(h=e.searchS3,F=!0);p.jqXHR=h({type:b.method,url:k.ajaxUrl,data:v,dataType:"json",cache:!1,success:function(x){if(F){var y=document.createElement("a");y.href=window.location.href;const C=new URLSearchParams(y.search);C.get("$search")||
(C.append("$search","session"),y.search=C.toString(),window.history.replaceState(null,null,y.href))}y=k.totalRecords;x.recordsFiltered!==w&&(y=x.recordsFiltered,k.totalRecords=x.recordsFiltered);g.store(l,x.data,y);d=e.extend(!0,{},x);l!=r&&x.data.splice(0,r-l);-1!=t&&x.data.splice(t,x.data.length);m(x)}})}else p=e.extend(!0,{},d,{draw:h.draw}),p.data=v,m(p)}}},_initCache:function(){var a=e(this.selector+"_dataTable_cache");return this.pipelineCache=a=0<a.length?JSON.parse(a.val()):{}},_headerCallback:function(){},
_rowCallback:function(){var a=this,b=this.tableConfig,c=b.actionCol,d=b.rowActions;return function(f,g){var k=/>(.*)</i.exec(g[c]);k=null===k?g[c]:k[1];if(d.length||b.bulkActions){for(var h=[],m=0;m<d.length;m++)h.push(a._renderActionButton(k,d[m]));e("td:eq("+c+")",f).html(h.join(""))}b.bulkActions&&a._bulkSelect(f,B(k,a.selectedRows));if(m=b.rowStyles){h=e(f);for(var p in m)-1!=B(k,m[p])&&h.addClass(p)}a._truncateCellContents(f,g);return f}},_drawCallback:function(){var a=this;return function(b){var c=
e(a.element),d=a.selector,f=a.outerForm,g=a.ajaxUrl;g&&f.find("a.permalink").each(function(){var l=e(this);l.attr("href",G(l.attr("href"),g))});a._renderBulkActions();a._variableColumnsButton();var k=b.fnRecordsDisplay();1<Math.ceil(k/b._iDisplayLength)?e(d+"_paginate").show():e(d+"_paginate").hide();f=e(".dt-export-options",f);f=e(".list_formats, .separator",f);0===k?f.hide():f.show();e(d+" .s3_modal").length&&S3.addModals();d=c.closest(".dt-contents");d.length&&(0<k?d.find(".empty").hide().siblings(".dt-wrapper").show():
d.find(".empty").show().siblings(".dt-wrapper").hide());var h=a.tableConfig;if((k=h.group)&&k.length){var m=[];k.forEach(function(l,r){a._renderGroups(b,l[0],h.groupTitles[r]||[],h.groupTotals[r]||{},m,r+1);m.push(l[0])});if(h.shrinkGroupedRows){var p,n;e("tbody tr",c).each(function(){var l=e(this);l.hasClass("group")?(p=l.data("level"),n=l.data("group")):p&&n&&!l.hasClass("spacer")&&l.addClass("xgroup_"+p+"_"+n).addClass("collapsable")});e(".collapsable").hide()}}}},_renderActionButton:function(a,
b){var c="",d=b.restrict;if(d&&d.constructor===Array&&-1==d.indexOf(a)||(d=b.exclude)&&d.constructor===Array&&-1!=d.indexOf(a))return c;c=b.label;b.icon?c='<i class="'+b.icon+'" alt="'+c+'"> </i>':b.img&&(c='<img src="'+b.icon+'" alt="'+c+'"></img>');d=b._disabled?' disabled="disabled"':"";const f=b._title||b.label,g=b._class;var k=/%5Bid%5D/g;b._onclick?(a=b._onclick.replace(k,a),c='<a class="'+g+'" onclick="'+a+d+'">'+c+"</a>"):b.url?(k=b.url.replace(k,a),(b=b._target||"")&&(b=' target="'+b+'"'),
c='<a db_id="'+a+'" class="'+g+'" href="'+k+'" title="'+f+'"'+b+d+">"+c+"</a>"):((b=b._ajaxurl||"")&&(b=' data-url="'+b+'"'),c='<a db_id="'+a+'" class="'+g+'" title="'+f+'"'+b+d+">"+c+"</a>");return c},ajaxAction:function(a){var b=e(this.element),c=this.outerForm;return function(d){d.stopPropagation();d.preventDefault();if(!a||confirm(a)){var f=e(this);d=f.attr("db_id");f=f.data("url");var g={},k=e('input[name="_formkey"]',c).first().val();k!==w&&(g._formkey=k);f&&d&&e.ajaxS3({url:f.replace(/%5Bid%5D/g,
d),type:"POST",dataType:"json",data:g,success:function(){b.dataTable().fnReloadAjax()}})}}},_truncateCellContents:function(a,b){var c=this.tableConfig,d=c.textMaxLength,f=c.textShrinkLength,g=null,k=0;c.group&&(g=c.group.map(function(p){return p[0]}));for(c=0;c<b.length;c++)if(-1==e.inArray(c,g)){var h=b[c];if(h.length>d&&!h.match(/<.*>/)){var m='<div class="dt-truncate"><span class="ui-icon ui-icon-zoomin" style="float:right"></span>'+h.substr(0,f)+"&hellip;</div>";h='<div  style="display:none" class="dt-truncate"><span class="ui-icon ui-icon-zoomout" style="float:right"></span>'+
h+"</div>";e("td:eq("+k+")",a).html(m+h)}k++}},_renderBulkActions:function(){var a=this.tableConfig.bulkActions;let b=e('<select class="bulk-action-select">'),c=!1;if(a){let d=!0;1!=a.length&&(d=!1,e("<option>").text(i18n.selectAction).prop({disabled:!0,selected:!0}).appendTo(b));a.forEach(function(f){let g=e("<option>"),k={min:1,max:null},h,m;if(f.hasOwnProperty("label")){h=""+f.label;if(!h)return;e.extend(k,{name:h,value:h},f)}else{if(f.constructor===Array)h=""+f[0],m=""+f[1],2<f.length&&(f=f[2],
g.addClass(f),"pair-action"==f&&(k.min=k.max=2));else if("string"==typeof f)m=h=""+f;else return;e.extend(k,{mode:"submit",name:m,value:h})}h&&(g.text(h),g.attr("value",k.value),g.data("action",k),d&&(d=!1,g.prop("selected",!0)),b.append(g),c=!0)})}if(c&&(a=e(".dataTables_wrapper",this.outerForm),!e(".dataTables_bulk",a).length)){let d=e('<label class="dataTables_bulk">'),f=e('<button class="action-btn btn bulk-action-execute" type="button">');f.text(i18n.executeBulkAction).prop("disabled",!0);d.text(i18n.selectedRecords+
":").append(b).append(f).prependTo(a);this._bulkActionSelect(b)}this._bulkToggleAllSelected()},_bulkActionSelect:function(a){var b=e(":selected",e(a)).data("action");a=e(".bulk-action-execute",this.outerForm);if(b){let c=b.min,d=b.max;b=this.selectedRows.length;0==b||c&&b<c||d&&b>d?a.prop("disabled",!0):a.prop("disabled",!1)}else a.prop("disabled",!0)},_bulkActionExecute:function(a){let b=e(a);a=e.Deferred();b.prop("disabled",!0);var c=e(".bulk-action-select",b.closest(".dataTables_bulk"));c=e(":selected",
c);if(c.length){a=c.data("action");c=a.mode;let d=this.selectedRows.length;if(a.min&&d<a.min||a.max&&d>a.max){b.prop("disabled",!1);return}switch(c){case "ajax":a=this._bulkActionAjax(a);break;default:a=this._bulkActionSubmit(a)}}else a.resolve();a.then(function(){b.prop("disabled",!1)})},_bulkActionAjax:function(a){let b=e.Deferred();var c=a.confirm;if(!c||confirm(c)){c=a.url;c===w&&(c=window.location.href);var d=S3.search.getCurrentFilters();d.length&&(c=S3.search.filterURL(c,d));d={type:"GET",
url:c,data:{}};S3.search.searchRewriteAjaxOptions(d,"ajax","submit");c=d.url;d=JSON.parse(d.data);let f=this.outerForm,g={};["mode","selected","_formkey","_timezone","_utc_offset"].forEach(function(n){let l=e('input[type=hidden][name="'+n+'"]',f);l.length&&(g[n]=l.val())});let k=a.name,h=a.value;k&&h&&(g[k]=h);e.extend(d,g);S3.hideAlerts();let m=e(this.element),p=this;e.ajaxS3({url:c,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(n){n.dialog?
p._bulkActionDialog(a,n.dialog,g):(e(".bulk-select-all",m).prop("checked",!1),p.selectedRows=[],p.selectionMode="Inclusive",m.dataTable().api().draw(!1),m.dataTable().fnReloadAjax());b.resolve()}})}else b.resolve();return b},_bulkActionDialog:function(a,b,c){let d=this.eventNamespace,f;try{f=e(b)}catch(p){return}let g=f;"FORM"!=g.prop("tagName")&&(g=e("form",f));if(g.length){b=function(r,t,q=!1,u=!1){if(u||!e('input[name="'+r+'"]',g).length)u=document.createElement("input"),u.type="hidden",u.name=
r,u.value=q?JSON.stringify(n[l]):t,g.append(e(u))};var k=g.attr("action");k&&=k.split("#")[0];k||(k=a.url);k||(k=window.location.href);let p=S3.search.getCurrentFilters();p.length&&(k=S3.search.filterURL(k,p));k={type:"GET",url:k};S3.search.searchRewriteAjaxOptions(k,"form","submit");let n=k.data,l;if(n)for(l in n)b(l,n[l],!0);g.attr("action",k.url);g.off(d).on("submit"+d,function(){e(".cancel-form-btn",h).remove()});if(c)for(l in c)b(l,c[l],!1)}let h=e("<div>").hide().appendTo(e("body")),m=h.append(f).show().dialog({title:a.label,
autoOpen:!1,minHeight:480,minWidth:320,modal:!0,closeText:"",open:function(){e(".ui-widget-overlay").off(d).on("click"+d,function(){m.dialog("close")});e(".cancel-form-btn",h).off(d).on("click"+d,function(){m.dialog("close")})},close:function(){h.hide().remove()}});m.dialog("open")},_bulkActionSubmit:function(a){let b=e.Deferred();var c=a.name;let d=a.value,f=a.confirm;c&&d&&(!f||confirm(f))&&(a=this._bulkActionForm(a),c=e('<input type="hidden">').attr("name",c).val(d),e(a).append(c),document.body.appendChild(a),
a.submit());return b.resolve()},_bulkActionForm:function(a){let b=document.createElement("form");b.method="POST";b.target="_self";b.enctype="multipart/form-data";b.style.display="none";let c=e(this.element).closest("form");["_formkey","mode","selected","filterURL","job_id"].forEach(function(f){let g=e('input[type=hidden][name="'+f+'"]',c);if(g.length){let k=document.createElement("input");k.type="hidden";k.name=f;k.value=g.val();b.appendChild(k)}});a=a.url;a==w&&(a=window.location.href);var d=S3.search.getCurrentFilters();
d.length&&(a=S3.search.filterURL(a,d));a={type:"GET",url:a};S3.search.searchRewriteAjaxOptions(a,"form","submit");if(d=a.data){let f,g;for(f in d)g=document.createElement("input"),g.type="hidden",g.name=f,g.value=JSON.stringify(d[f]),b.appendChild(g)}b.action=a.url;return b},_bulkSelectRestore:function(){if(this.tableConfig.bulkActions){var a=JSON.parse(e(this.selector+"_dataTable_bulkSelection").val());null===a&&(a=[]);this.selectedRows=a;this.selectionMode="Inclusive"}},_bulkSelect:function(a,b){e(this.element);
let c=this.tableConfig.bulkSingle;-1==b?(e(a).removeClass("row_selected"),e(".bulkcheckbox",a).prop("checked",!1)):(c&&e(a).closest("table").find("tr").removeClass("row_selected").find(".bulkcheckbox").prop("checked",!1),e(a).addClass("row_selected"),e(".bulkcheckbox",a).prop("checked",!0));this._bulkToggleAllSelected();e(this.selector+"_dataTable_bulkMode").val(this.selectionMode);e(this.selector+"_dataTable_bulkSelection").val(this.selectedRows.join(","));this._bulkActionSelect(e(".bulk-action-select",
this.outerForm))},_bulkSelectRow:function(){e(this.element);var a=this;return function(){var b=e(this),c=b.data("dbid"),d=a.selectedRows,f=B(c,d);-1==f?(a.tableConfig.bulkSingle?a.selectedRows=[c]:d.push(c),f=0):(d.splice(f,1),f=-1);a._bulkSelect(b.closest("tr"),f)}},_bulkSelectAll:function(){var a=e(this.element),b=this;return function(){let c=e("td.dt-bulk",a),d=b.selectedRows,f=e(this).prop("checked");c.each(function(){let g=e(".bulkcheckbox",this).data("dbid"),k=d.indexOf(g);f&&-1==k?d.push(g):
f||-1==k||d.splice(k,1)});a.dataTable().api().draw(!1)}},_bulkToggleAllSelected:function(){const a=e(this.element);e(".bulk-select-all",a).prop("checked",!e(".bulkcheckbox:not(:checked)",a).length)},_variableColumnsButton:function(){var a=this.outerForm;const b=e(".dataTables_wrapper",a);a=e(".column-selector",a);this._parseConfig();a.length&&!e(".dt-variable-columns",b).length&&e('<button type="button" class="dt-variable-columns"><i class="fa fa-columns"></button>').hide().prop("title",i18n.selectColumns).prependTo(b).variableColumns().show()},
_renderGroups:function(a,b,c,d,f,g){var k=a.aoColumns.length,h=e(this.element);h=e("tbody tr",h);for(var m,p,n,l=1,r=0,t=0,q="",u=0;u<h.length;u++)if(m=e(h[u]),!m.hasClass("spacer")&&a.aoData.length)if(p=a.aoData[a.aiDisplay[r]]._aData,m.hasClass("group")){n=w;var v=m.data("group");q=f.map(function(A){return this[A]},p).join("_")}else{p=p[b];if(p!==n){for(;c.length>t&&p!=c[t][0];)n=c[t][1],this._insertGroupHeader(m,n,g,l,v,k,d,q),t++,l++;c.length>t?(n=c[t][1],t++):n=p;this._insertGroupHeader(m,n,
g,l,v,k,d,q,!0);l++;n=p}r+=1;this.tableConfig.shrinkGroupedRows&&m.hide()}for(m=h[h.length-1];c.length>t;)n=c[t][1],this._insertGroupHeader(m,n,g,l,v,k,d,q,!1,!0),t++,l++},_insertGroupHeader:function(a,b,c,d,f,g,k,h,m,p){var n=this.tableConfig;d=e('<tr class="group">').data({level:""+c,group:""+d}).addClass("level_"+c);var l=n.shrinkGroupedRows;if(f){var r=""+(c-1);d.addClass("xgroup_"+r+"_"+f).data({parentLevel:r,parentGroup:f});l&&d.addClass("collapsable")}f=e("<td>").attr("colspan",g).appendTo(d);
for(r=1;r<c;r++)e('<span class="group-indent">').appendTo(f);1<c&&(e('<span class="ui-icon ui-icon-triangle-1-e group-closed">').appendTo(f),e('<span class="ui-icon ui-icon-triangle-1-s group-opened">').hide().appendTo(f));r="";null!=k[b]?r=" ("+k[b]+")":(h+=b,null!=k[h]&&(r=" ("+k[h]+")"));f.append(b+r);l&&m&&(b=n.groupIcon|0,b=b.length>=c?b[c-1]:"icon",k=e('<span class="group-expand">').appendTo(f),m=e('<span class="group-collapse">').hide().appendTo(f),"text"==b?(k.text("\u2192"),m.text("\u2193")):
"icon"==b&&(k.addClass("ui-icon ui-icon-arrowthick-1-e"),m.addClass("ui-icon ui-icon-arrowthick-1-s")));p?d.insertAfter(a):d.insertBefore(a);n.groupSpacing&&(a=d.prevAll("tr.group").first(),a.length&&a.data("level")==c&&(a=a.data("group"),g=e("<td>").attr("colspan",g),g=e('<tr class="spacer">').append(g),l&&g.addClass("collapsable"),g.addClass("xgroup_"+c+"_"+a).insertBefore(d)))},_toggleGroup:function(a,b){switch(this.tableConfig.shrinkGroupedRows){case "individual":b?this._expandGroup(a):this._collapseGroup(a);
break;case "accordion":if(b){this._expandGroup(a);b=".level_"+a.data("level");var c=a.data("parentGroup");c&&(b+=".xgroup_"+a.data("parentLevel")+"_"+c);var d=this;a.siblings("tr.group"+b).each(function(){d._collapseGroup(e(this))})}else this._collapseGroup(a)}},_expandGroup:function(a){var b=a.data("level"),c=a.data("group");a.siblings("tr.xgroup_"+b+"_"+c).show();e(".group-expand, .group-closed",a).hide();e(".group-collapse, .group-opened",a).show()},_collapseGroup:function(a){var b=a.data("level"),
c=a.data("group"),d=this;a.siblings("tr.xgroup_"+b+"_"+c).each(function(){var f=e(this);f.hasClass("group")&&d._collapseGroup(f);f.hide()});e(".group-expand, .group-closed",a).show();e(".group-collapse, .group-opened",a).hide()},_exportFormat:function(){var a=e(this.element),b=this;return function(){var c=a.dataTable().fnSettings(),d=e(this).data("url"),f=e(this).data("extension");if(c){var g="id="+b.tableID,k=c.oPreviousSearch.sSearch,h=c.aaSorting,m=c.aaSortingFixed;c=c.aoColumns;k&&(g+="&sSearch="+
k+"&iColumns="+c.length);null!==m&&(h=m.concat(h));c.forEach(function(p,n){p.bSortable||(g+="&bSortable_"+n+"=false")});g+="&iSortingCols="+h.length;h.forEach(function(p,n){g+="&iSortCol_"+n+"="+h[n][0]+"&sSortDir_"+n+"="+h[n][1]});d=E(d,f,g)}else d=E(d,f);e.searchDownloadS3!==w?e.searchDownloadS3(d,"_blank"):window.open(d)}},_initExportFormats:function(){var a=this._parseConfig();if(a!==w&&(a=a.ajaxUrl)&&S3.search!==w){var b=document.createElement("a");b.href=a;if(b.search){var c=b.search.slice(1).split("&").map(function(d){d=
d.split("=");return[S3.urlDecode(d[0]),S3.urlDecode(d[1])]}).filter(function(d){return-1!=d[0].indexOf(".")});e(".dt-export",this.outerForm).each(function(){var d=e(this),f=d.data("url");f&&d.data("url",S3.search.filterURL(f,c))})}}},_bindEvents:function(){var a=e(this.element),b=this.outerForm,c=this.eventNamespace,d=this;a.on("click"+c,".dt-truncate .ui-icon-zoomin, .dt-truncate .ui-icon-zoomout",function(){e(this).parent().toggle().siblings(".dt-truncate").toggle();return!1});this._initExportFormats();
e(".dt-export",b).on("click"+c,this._exportFormat());a.on("click"+c,".dt-ajax-delete",this.ajaxAction(i18n.delete_confirmation));a.on("click"+c,".group-collapse, .group-expand",function(){var f=e(this),g=f.closest("tr.group"),k=!0;f.hasClass("group-collapse")&&(k=!1);d._toggleGroup(g,k)});this.tableConfig.bulkActions&&(a.on("click"+c,".bulk-select-all",this._bulkSelectAll()),a.on("change"+c,".bulkcheckbox",this._bulkSelectRow()),e(".bulk-action-select",b).on("change"+c,function(){d._bulkActionSelect(this)}),
e(".bulk-action-execute",b).on("click"+c,function(f){f.preventDefault();f.stopPropagation();d._bulkActionExecute(this)}));return this},_unbindEvents:function(){var a=e(this.element),b=this.outerForm,c=this.eventNamespace;a.off(c);e(".dt-export",b).off(c);e(".dt-variable-columns",b).off(c);e(".bulk-action-select",b).off(c);e(".bulk-action-execute",b).off(c);return this}});e.fn.dataTable.Api.register("clearPipeline()",function(){return this.iterator("table",function(a){a.clearCache=!0})});e.fn.dataTableExt.oApi.fnReloadAjax=
function(a,b){"undefined"!=b&&null!=b&&(a.sAjaxSource=b);this.oApi._fnProcessingDisplay(a,!0);var c=this;a.ajax({},function(){c.oApi._fnClearTable(a);c.fnDraw()},a)};e(function(){if(S3.dataTables){var a=S3.dataTables.id;a&&a.forEach(function(b){e("#"+b).dataTableS3({destroy:!1})})}})})(jQuery);
